{
  "title": "ubuntu",
  "author": "heavenmei",
  "url": "/2023-12-23-ubuntu-docker",
  "date": "2023-12-23T00:00:00.000Z",
  "body": {
    "raw": "> 在服务器中安装docker， 并创建pytorch运行环境，实现ssh远程端口登录\n\ndocker安装详见一键安装脚本\nhttps://gitee.com/heavenmei/one-step-install\n\n### 创建容器\n\n镜像仓库： https://hub.docker.com/r/pytorch/pytorch/tags\n```shell\ndocker pull pytorch/pytorch:2.1.2-cuda11.8-cudnn8-devel\n```\n运行容器，这一步尤其重要，要指定好一些参数\n```shell\ndocker run -itd -p 8080:8080 -gpus all --name \"hhw_pyt2\"\n```\n\n\n### 环境配置\n```shell\napt-get update\napt-get install -y curl git openssh-server vim\n```\n\n\n\n### 配置ssh 连接docker 容器\n```shell\n# 1. 安装\napt-get install -y openssh-server \n# 2. 设置登录密码 \npasswd \n\n# 3. 修改配置文件 \nvim /etc/ssh/sshd_config \n开启root登录 PermitRootLogin yes \n开启密码认证 PasswordAuthentication yes\n\n# 4.设置开机自启 systemctl enable ssh 只在宿主机上有效\necho \"service ssh start\" >> ~/.bashrc\n\n# 5.重启\nservice ssh restart\n```\n\n设置完成，即可通过ssh远程访问：（默认root） `ssh -p PORT root@IP`\n\n**SSH连接Docker容器时环境变量丢失** \n在容器中安装openssh-server后，启动ssh服务，然后从外部连接ssh进入docker后，会发现所有的容器环境变量都不见了，只剩下一些ssh必要的环境变量 可以把容器主进程的环境变量拿出来：在ssh的shell中执行。\n```shell\nexport $(cat /proc/1/environ |tr '\\0' '\\n' | xargs)\n# 加到.bashrc 登录默认进入改进程\necho \"export \\$(cat /proc/1/environ |tr '\\0' '\\n' | xargs)\" >> ~/.bashrc\n```",
    "code": "var Component=(()=>{var h=Object.create;var s=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var u=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),m=(l,e)=>{for(var r in e)s(l,r,{get:e[r],enumerable:!0})},t=(l,e,r,c)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let a of y(e))!g.call(l,a)&&a!==r&&s(l,a,{get:()=>e[a],enumerable:!(c=p(e,a))||c.enumerable});return l};var B=(l,e,r)=>(r=l!=null?h(F(l)):{},t(e||!l||!l.__esModule?s(r,\"default\",{value:l,enumerable:!0}):r,l)),E=l=>t(s({},\"__esModule\",{value:!0}),l);var d=u((x,o)=>{o.exports=_jsx_runtime});var v={};m(v,{default:()=>C,frontmatter:()=>k});var n=B(d()),k={title:\"ubuntu\",date:new Date(17032896e5),author:\"heavenmei\",categories:[\"Post\"],url:\"/2023-12-23-ubuntu-docker\"};function i(l){let e=Object.assign({blockquote:\"blockquote\",p:\"p\",a:\"a\",h3:\"h3\",span:\"span\",div:\"div\",figure:\"figure\",pre:\"pre\",code:\"code\",strong:\"strong\"},l.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"\\u5728\\u670D\\u52A1\\u5668\\u4E2D\\u5B89\\u88C5docker\\uFF0C \\u5E76\\u521B\\u5EFApytorch\\u8FD0\\u884C\\u73AF\\u5883\\uFF0C\\u5B9E\\u73B0ssh\\u8FDC\\u7A0B\\u7AEF\\u53E3\\u767B\\u5F55\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[`docker\\u5B89\\u88C5\\u8BE6\\u89C1\\u4E00\\u952E\\u5B89\\u88C5\\u811A\\u672C\n`,(0,n.jsx)(e.a,{href:\"https://gitee.com/heavenmei/one-step-install\",children:\"https://gitee.com/heavenmei/one-step-install\"})]}),`\n`,(0,n.jsxs)(e.h3,{id:\"\\u521B\\u5EFA\\u5BB9\\u5668\",children:[(0,n.jsx)(e.a,{className:\"header-anchor\",href:\"#\\u521B\\u5EFA\\u5BB9\\u5668\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u521B\\u5EFA\\u5BB9\\u5668\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u955C\\u50CF\\u4ED3\\u5E93\\uFF1A \",(0,n.jsx)(e.a,{href:\"https://hub.docker.com/r/pytorch/pytorch/tags\",children:\"https://hub.docker.com/r/pytorch/pytorch/tags\"})]}),`\n`,(0,n.jsx)(e.div,{className:\"remark-code-container\",children:(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"shell\",\"data-theme\":\"github-dark\",raw:`docker pull pytorch/pytorch:2.1.2-cuda11.8-cudnn8-devel\n`,children:(0,n.jsx)(e.code,{\"data-language\":\"shell\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"docker\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" pull\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" pytorch/pytorch:2.1.2-cuda11.8-cudnn8-devel\"})]})})})})}),`\n`,(0,n.jsx)(e.p,{children:\"\\u8FD0\\u884C\\u5BB9\\u5668\\uFF0C\\u8FD9\\u4E00\\u6B65\\u5C24\\u5176\\u91CD\\u8981\\uFF0C\\u8981\\u6307\\u5B9A\\u597D\\u4E00\\u4E9B\\u53C2\\u6570\"}),`\n`,(0,n.jsx)(e.div,{className:\"remark-code-container\",children:(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"shell\",\"data-theme\":\"github-dark\",raw:`docker run -itd -p 8080:8080 -gpus all --name \"hhw_pyt2\"\n`,children:(0,n.jsx)(e.code,{\"data-language\":\"shell\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"docker\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" run\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" -itd\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" -p\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" 8080:8080\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" -gpus\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" all\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" --name\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:' \"hhw_pyt2\"'})]})})})})}),`\n`,(0,n.jsxs)(e.h3,{id:\"\\u73AF\\u5883\\u914D\\u7F6E\",children:[(0,n.jsx)(e.a,{className:\"header-anchor\",href:\"#\\u73AF\\u5883\\u914D\\u7F6E\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u73AF\\u5883\\u914D\\u7F6E\"]}),`\n`,(0,n.jsx)(e.div,{className:\"remark-code-container\",children:(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"shell\",\"data-theme\":\"github-dark\",raw:`apt-get update\napt-get install -y curl git openssh-server vim\n`,children:(0,n.jsxs)(e.code,{\"data-language\":\"shell\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"apt-get\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" update\"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"apt-get\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" install\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" -y\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" curl\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" git\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" openssh-server\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" vim\"})]})]})})})}),`\n`,(0,n.jsxs)(e.h3,{id:\"\\u914D\\u7F6Essh-\\u8FDE\\u63A5docker-\\u5BB9\\u5668\",children:[(0,n.jsx)(e.a,{className:\"header-anchor\",href:\"#\\u914D\\u7F6Essh-\\u8FDE\\u63A5docker-\\u5BB9\\u5668\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"\\u914D\\u7F6Essh \\u8FDE\\u63A5docker \\u5BB9\\u5668\"]}),`\n`,(0,n.jsx)(e.div,{className:\"remark-code-container\",children:(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"shell\",\"data-theme\":\"github-dark\",raw:`# 1. \\u5B89\\u88C5\napt-get install -y openssh-server \n# 2. \\u8BBE\\u7F6E\\u767B\\u5F55\\u5BC6\\u7801 \npasswd \n\n# 3. \\u4FEE\\u6539\\u914D\\u7F6E\\u6587\\u4EF6 \nvim /etc/ssh/sshd_config \n\\u5F00\\u542Froot\\u767B\\u5F55 PermitRootLogin yes \n\\u5F00\\u542F\\u5BC6\\u7801\\u8BA4\\u8BC1 PasswordAuthentication yes\n\n# 4.\\u8BBE\\u7F6E\\u5F00\\u673A\\u81EA\\u542F systemctl enable ssh \\u53EA\\u5728\\u5BBF\\u4E3B\\u673A\\u4E0A\\u6709\\u6548\necho \"service ssh start\" >> ~/.bashrc\n\n# 5.\\u91CD\\u542F\nservice ssh restart\n`,children:(0,n.jsxs)(e.code,{\"data-language\":\"shell\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6A737D\"},children:\"# 1. \\u5B89\\u88C5\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"apt-get\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" install\"}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\" -y\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" openssh-server\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" \"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6A737D\"},children:\"# 2. \\u8BBE\\u7F6E\\u767B\\u5F55\\u5BC6\\u7801 \"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"passwd\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" \"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6A737D\"},children:\"# 3. \\u4FEE\\u6539\\u914D\\u7F6E\\u6587\\u4EF6 \"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"vim\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" /etc/ssh/sshd_config\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"\\u5F00\\u542Froot\\u767B\\u5F55\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" PermitRootLogin\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" yes\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" \"})]}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"\\u5F00\\u542F\\u5BC6\\u7801\\u8BA4\\u8BC1\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" PasswordAuthentication\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" yes\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6A737D\"},children:\"# 4.\\u8BBE\\u7F6E\\u5F00\\u673A\\u81EA\\u542F systemctl enable ssh \\u53EA\\u5728\\u5BBF\\u4E3B\\u673A\\u4E0A\\u6709\\u6548\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"echo\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:' \"service ssh start\"'}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" >>\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" ~/.bashrc\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:\" \"}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6A737D\"},children:\"# 5.\\u91CD\\u542F\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"service\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" ssh\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" restart\"})]})]})})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u8BBE\\u7F6E\\u5B8C\\u6210\\uFF0C\\u5373\\u53EF\\u901A\\u8FC7ssh\\u8FDC\\u7A0B\\u8BBF\\u95EE\\uFF1A\\uFF08\\u9ED8\\u8BA4root\\uFF09\\xA0\",(0,n.jsx)(e.code,{children:\"ssh -p PORT root@IP\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.strong,{children:\"SSH\\u8FDE\\u63A5Docker\\u5BB9\\u5668\\u65F6\\u73AF\\u5883\\u53D8\\u91CF\\u4E22\\u5931\"}),`\n\\u5728\\u5BB9\\u5668\\u4E2D\\u5B89\\u88C5openssh-server\\u540E\\uFF0C\\u542F\\u52A8ssh\\u670D\\u52A1\\uFF0C\\u7136\\u540E\\u4ECE\\u5916\\u90E8\\u8FDE\\u63A5ssh\\u8FDB\\u5165docker\\u540E\\uFF0C\\u4F1A\\u53D1\\u73B0\\u6240\\u6709\\u7684\\u5BB9\\u5668\\u73AF\\u5883\\u53D8\\u91CF\\u90FD\\u4E0D\\u89C1\\u4E86\\uFF0C\\u53EA\\u5269\\u4E0B\\u4E00\\u4E9Bssh\\u5FC5\\u8981\\u7684\\u73AF\\u5883\\u53D8\\u91CF \\u53EF\\u4EE5\\u628A\\u5BB9\\u5668\\u4E3B\\u8FDB\\u7A0B\\u7684\\u73AF\\u5883\\u53D8\\u91CF\\u62FF\\u51FA\\u6765\\uFF1A\\u5728ssh\\u7684shell\\u4E2D\\u6267\\u884C\\u3002`]}),`\n`,(0,n.jsx)(e.div,{className:\"remark-code-container\",children:(0,n.jsx)(e.figure,{\"data-rehype-pretty-code-figure\":\"\",children:(0,n.jsx)(e.pre,{style:{backgroundColor:\"#24292e\",color:\"#e1e4e8\"},tabIndex:\"0\",\"data-language\":\"shell\",\"data-theme\":\"github-dark\",raw:`export $(cat /proc/1/environ |tr '\\\\0' '\\\\n' | xargs)\n# \\u52A0\\u5230.bashrc \\u767B\\u5F55\\u9ED8\\u8BA4\\u8FDB\\u5165\\u6539\\u8FDB\\u7A0B\necho \"export \\\\$(cat /proc/1/environ |tr '\\\\0' '\\\\n' | xargs)\" >> ~/.bashrc\n`,children:(0,n.jsxs)(e.code,{\"data-language\":\"shell\",\"data-theme\":\"github-dark\",style:{display:\"grid\"},children:[(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\"export\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\" $(\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"cat\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" /proc/1/environ\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" |\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\"tr\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" '\\\\0'\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" '\\\\n'\"}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" |\"}),(0,n.jsx)(e.span,{style:{color:\"#B392F0\"},children:\" xargs\"}),(0,n.jsx)(e.span,{style:{color:\"#E1E4E8\"},children:\")\"})]}),`\n`,(0,n.jsx)(e.span,{\"data-line\":\"\",children:(0,n.jsx)(e.span,{style:{color:\"#6A737D\"},children:\"# \\u52A0\\u5230.bashrc \\u767B\\u5F55\\u9ED8\\u8BA4\\u8FDB\\u5165\\u6539\\u8FDB\\u7A0B\"})}),`\n`,(0,n.jsxs)(e.span,{\"data-line\":\"\",children:[(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"echo\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:' \"export '}),(0,n.jsx)(e.span,{style:{color:\"#79B8FF\"},children:\"\\\\$\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:`(cat /proc/1/environ |tr '\\\\0' '\\\\n' | xargs)\"`}),(0,n.jsx)(e.span,{style:{color:\"#F97583\"},children:\" >>\"}),(0,n.jsx)(e.span,{style:{color:\"#9ECBFF\"},children:\" ~/.bashrc\"})]})]})})})})]})}function b(l={}){let{wrapper:e}=l.components||{};return e?(0,n.jsx)(e,Object.assign({},l,{children:(0,n.jsx)(i,l)})):i(l)}var C=b;return E(v);})();\n;return Component;"
  },
  "_id": "post/2023-12-23-ubuntu-docker-pytorch-ssh.mdx",
  "_raw": {
    "sourceFilePath": "post/2023-12-23-ubuntu-docker-pytorch-ssh.mdx",
    "sourceFileName": "2023-12-23-ubuntu-docker-pytorch-ssh.mdx",
    "sourceFileDir": "post",
    "contentType": "mdx",
    "flattenedPath": "post/2023-12-23-ubuntu-docker-pytorch-ssh"
  },
  "type": "Post",
  "slug": "/post/2023-12-23-ubuntu-docker-pytorch-ssh",
  "slugAsParams": "2023-12-23-ubuntu-docker-pytorch-ssh"
}